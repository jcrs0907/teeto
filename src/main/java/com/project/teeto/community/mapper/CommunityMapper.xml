<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.teeto.community.mapper.CommunityMapper">

    <insert id="insert"
            parameterType="community">
      <selectKey keyProperty="cmntSeqno" resultType="integer" order="BEFORE">
          SELECT TB_COMMUNITY_L_SEQ.nextval FROM DUAL
      </selectKey> /* insert - CommunityMapper.xml : 211013 @eunseo */
      INSERT INTO TB_COMMUNITY_L (
           CMNT_SEQNO
          ,CMNT_TP_CD
          ,MEM_ID
          ,MENTEE_ID
          ,MENTO_ID
          ,CMNT_TITLE
          ,CMNT_CTT
          ,CMNT_FILE_SEQNO
          ,CRE_DTTM
      ) VALUES (
           #{cmntSeqno}
          ,#{cmntTpCd}
          ,#{memId}
          ,#{menteeId, jdbcType=VARCHAR}
          ,#{mentoId, jdbcType=VARCHAR}
          ,#{cmntTitle}
          ,#{cmntCtt}
          ,#{cmntFileSeqno, jdbcType=INTEGER}
          ,SYSDATE
      )
    </insert>

    <select id="getList"
            parameterType="String"
            resultType="community">
        SELECT /* select - CommunityMapper.xml : 211013 @eunseo */
               C.CMNT_SEQNO AS cmntSeqno
              ,C.CMNT_TP_CD AS cmntTpCd
              ,CD.CD_NM AS cmntTpCdNm
              ,CASE WHEN C.CMNT_TP_CD = 'CM01' THEN TMI.MENTEE_NM
                    ELSE T.MENTO_NM
               END AS nickName
              ,C.CMNT_TITLE AS cmntTitle
              ,C.CMNT_VIEW_CNT AS cmntViewCnt
              ,TO_CHAR(C.CRE_DTTM) AS creDttm
        FROM TB_COMMUNITY_L C
        LEFT OUTER JOIN TB_CD_M CD ON C.CMNT_TP_CD = CD.CD
        LEFT OUTER JOIN TB_MENTEE_I TMI ON C.MENTEE_ID = TMI.MENTEE_ID
        LEFT OUTER JOIN TB_MENTO_I T ON C.MENTO_ID = T.MENTO_ID
        WHERE 1=1
        AND C.USE_YN = 'Y'
        AND C.CMNT_TP_CD = #{cmntTpCd}
        ORDER BY C.CRE_DTTM DESC
    </select>

    <select id="getMyList"
            parameterType="community"
            resultType="community">
        SELECT /* select - CommunityMapper.xml : 211013 @eunseo */
               C.CMNT_SEQNO AS cmntSeqno
              ,C.CMNT_TP_CD AS cmntTpCd
              ,CD.CD_NM AS cmntTpCdNm
              ,CASE WHEN C.CMNT_TP_CD = 'CM01' THEN TMI.MENTEE_NM
                    ELSE T.MENTO_NM
               END AS nickName
              ,C.CMNT_TITLE AS cmntTitle
              ,C.CMNT_VIEW_CNT AS cmntViewCnt
              ,TO_CHAR(C.CRE_DTTM) AS creDttm
        FROM TB_COMMUNITY_L C
        LEFT OUTER JOIN TB_CD_M CD ON C.CMNT_TP_CD = CD.CD
        LEFT OUTER JOIN TB_MENTEE_I TMI ON C.MENTEE_ID = TMI.MENTEE_ID
        LEFT OUTER JOIN TB_MENTO_I T ON C.MENTO_ID = T.MENTO_ID
        WHERE 1=1
        AND C.USE_YN = 'Y'
        AND C.CMNT_TP_CD = #{cmntTpCd}
        AND C.MEM_ID = #{memId}
        ORDER BY C.CRE_DTTM DESC
    </select>

    <select id="getDetail"
            parameterType="int"
            resultType="community">
        SELECT /* select - CommunityMapper.xml : 211014 @eunseo */
               C.CMNT_SEQNO AS cmntSeqno
              ,C.CMNT_TP_CD AS cmntTpCd
              ,CD.CD_NM AS cmntTpCdNm
              ,CASE WHEN C.CMNT_TP_CD = 'CM01' THEN TMI.MENTEE_NM
                    ELSE T.MENTO_NM
               END AS nickName
              ,C.CMNT_TITLE AS cmntTitle
              ,C.CMNT_CTT AS cmntCtt
              ,F.FILE_SEQNO AS cmntFileSeqno
              ,F.FILE_PATH AS cmntImgFilePath
              ,C.CMNT_VIEW_CNT AS cmntViewCnt
              ,TO_CHAR(C.CRE_DTTM) AS creDttm
        FROM TB_COMMUNITY_L C
        LEFT OUTER JOIN TB_CD_M CD ON C.CMNT_TP_CD = CD.CD
        LEFT OUTER JOIN TB_MENTEE_I TMI ON C.MENTEE_ID = TMI.MENTEE_ID
        LEFT OUTER JOIN TB_MENTO_I T ON C.MENTO_ID = T.MENTO_ID
        LEFT OUTER JOIN TB_FILE_M F ON C.CMNT_FILE_SEQNO = F.FILE_SEQNO
        WHERE 1=1
        AND C.USE_YN = 'Y'
        AND C.CMNT_SEQNO = #{cmntSeqno}
    </select>

    <select id="getCommentList"
            parameterType="int"
            resultType="community">
        SELECT /* select - CommunityMapper.xml : 211014 @eunseo */
               C.CMNT_CMMT_SEQNO AS cmntCmmtSeqno
              ,CASE WHEN CC.CMNT_TP_CD = 'CM01' THEN TMI.MENTEE_NM
                    ELSE T.MENTO_NM
               END AS nickName
              ,C.MENTEE_ID AS menteeId
              ,C.MENTO_ID AS mentoId
              ,C.CMNT_CMMT_CTT AS cmntCmmtCtt
              ,TO_CHAR(C.CRE_DTTM) AS creDttm
        FROM TB_COMMUNITY_COMMENT_L C
        LEFT OUTER JOIN TB_COMMUNITY_L CC ON C.CMNT_SEQNO = CC.CMNT_SEQNO
        LEFT OUTER JOIN TB_MENTEE_I TMI ON C.MENTEE_ID = TMI.MENTEE_ID
        LEFT OUTER JOIN TB_MENTO_I T ON C.MENTO_ID = T.MENTO_ID
        WHERE 1=1
        AND C.USE_YN = 'Y'
        AND C.CMNT_SEQNO = #{cmntSeqno}
        ORDER BY C.CRE_DTTM DESC
    </select>

    <update id="update"
            parameterType="community">
        UPDATE TB_COMMUNITY_L /* update - CommunityMapper.xml : 211014 @eunseo */
        SET
        <if test='cmntTitle != null and !cmntTitle.equals("")'>
            CMNT_TITLE = #{cmntTitle},
        </if>
        <if test='cmntCtt != null and !cmntCtt.equals("")'>
            CMNT_CTT = #{cmntCtt},
        </if>
        <if test='cmntFileSeqno != null'>
            CMNT_FILE_SEQNO = #{cmntFileSeqno},
        </if>
            UPT_DTTM = SYSDATE
        WHERE 1=1
        AND USE_YN = 'Y'
        AND CMNT_SEQNO = #{cmntSeqno}
    </update>
    
    <update id="delete"
            parameterType="community">
        UPDATE TB_COMMUNITY_L /* update - CommunityMapper.xml : 211014 @eunseo */
        SET
            USE_YN = 'N'
           ,UPT_DTTM = SYSDATE
        WHERE 1=1
        AND CMNT_SEQNO = #{cmntSeqno}
    </update>

    <update id="deleteAllComment"
            parameterType="int">
        UPDATE TB_COMMUNITY_COMMENT_L /* update - CommunityMapper.xml : 211014 @eunseo */
        SET
            USE_YN = 'N'
           ,UPT_DTTM = SYSDATE
        WHERE 1=1
        AND CMNT_SEQNO = #{cmntSeqno}
    </update>

    <insert id="insertComment"
            parameterType="community">
        <selectKey keyProperty="cmntCmmtSeqno" resultType="integer" order="BEFORE">
            SELECT TB_COMMUNITY_COMMENT_L_SEQ.nextval FROM DUAL
        </selectKey> /* insert - CommunityMapper.xml : 211014 @eunseo */
        INSERT INTO TB_COMMUNITY_COMMENT_L (
             CMNT_CMMT_SEQNO
            ,CMNT_SEQNO
            ,MEM_ID
            ,MENTEE_ID
            ,MENTO_ID
            ,CMNT_CMMT_CTT
            ,CRE_DTTM
        ) VALUES (
            #{cmntCmmtSeqno}
            ,#{cmntSeqno}
            ,#{memId}
            ,#{menteeId, jdbcType=VARCHAR}
            ,#{mentoId, jdbcType=VARCHAR}
            ,#{cmntCmmtCtt}
            ,SYSDATE
        )
    </insert>

    <update id="updateComment"
            parameterType="community">
        UPDATE TB_COMMUNITY_COMMENT_L /* update - CommunityMapper.xml : 211014 @eunseo */
        SET
            CMNT_CMMT_CTT = #{cmntCmmtCtt}
           ,UPT_DTTM = SYSDATE
        WHERE 1=1
        AND CMNT_CMMT_SEQNO = #{cmntCmmtSeqno}
    </update>

    <update id="deleteComment"
            parameterType="int">
        UPDATE TB_COMMUNITY_COMMENT_L /* update - CommunityMapper.xml : 211014 @eunseo */
        SET
            USE_YN = 'N'
           ,UPT_DTTM = SYSDATE
        WHERE 1=1
        AND CMNT_CMMT_SEQNO = #{cmntCmmtSeqno}
    </update>

</mapper>